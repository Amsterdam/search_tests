
---
- config:
    - testset: "Atlas search app tests"
    - variable_binds: {'headername': 'Content-Type', 'headervalue': 'application/json'}
    - generators:
        - 'woordje': {
                type: 'random_text', min_length: 2,
                max_lenght: 4, character_set: alphanumeric }
        - 'nummer': {
                type: 'random_text', min_length: 1,
                max_lenght: 2, character_set: digits }


- test:
    - name: "zoekadres"
    - url: "/atlas/search/adres/?q=silodam"


- test:
    - name: "typeahead"
    - headers: {'Content-Type': 'application/json'}
    - url: "/atlas/typeahead/?q=silodam"



- benchmark:
    - name: "autocompletebench"
    - generator_binds: {query: woordje}
    - url: {template: "/atlas/typeahead/?q=$query"}
    - warmup_runs: 0
    - 'benchmark_runs': 10
    - output_file: 'autocomplete_bench.json'
    - metrics:
        - total_time: total
        - total_time: mean

- benchmark:
    - name: "adresbench"
    - generator_binds: {query: woordje, nummer: nummer}
    - url: {template: "/atlas/search/adres/?q=$query%20$nummer"}
    - warmup_runs: 0
    - 'benchmark_runs': 10
    - output_file: 'adres_bench.json'
    - metrics:
        - total_time: total
        - total_time: mean


- test:
    - name: "typeaheadtest"
    - url: "/atlas/typeahead/?q=steph"
    - validators:
        - compare: {raw_body:, comparator: "contains", expected: "Stephan"}


- test:
    - name: "typeaheadpostcode"
    - url: "/atlas/typeahead/?q=1013"
    - validators:
        - compare: {raw_body:, comparator: "contains", expected: "1013"}


- test:
    - name: "zoekadres"
    - url: "/atlas/search/postcode/?q=1018"
    - validators:
        - compare: {jsonpath_mini: "count", comparator: "ge", expected: 3}
        - extract_test: {jsonpath_mini: "results", test: "exists"}
        - compare: {jsonpath_mini: "results.0.straatnaam", comparator: "eq", expected: "Nieuwe Achtergracht"}


- test:
    - name: "subjectsearch"
    - url: "/atlas/search/kadastraalsubject/?q=Stephan%20preeker"
    - validators:
        - compare: {header: "Content-Type", comparator: "contains", expected: "application/json"}
        - compare: {jsonpath_mini: "count", comparator: "eq", expected: 1}
        - extract_test: {jsonpath_mini: "results", test: "exists"}
        - compare: {jsonpath_mini: "results.0.naam", comparator: "eq", expected: "Stephan Jacob Preeker"}

- test:
    - name: "nummeraanduidingsearch"
    - url: "/atlas/search/adres/?q=rozengracht%202"
    - validators:
        - compare: {header: "Content-Type", comparator: "contains", expected: "application/json"}
        - compare: {jsonpath_mini: "count", comparator: "ge", expected: 3}
        - extract_test: {jsonpath_mini: "results", test: "exists"}
        - compare: {jsonpath_mini: "results.0.straatnaam", comparator: "eq", expected: "Rozengracht"}
        - compare: {jsonpath_mini: "results.0.huisnummer", comparator: "eq", expected: 2}

#
#
#
#
#
